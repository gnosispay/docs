---
title: IBAN Integration
description: IBAN cash-in to the GnosisPay Account via Monerium
---

We offer IBAN cash-in to the GnosisPay Account via Monerium for users in Europe (EU) and Switzerland.

## Check Availability

[First you need to check if the user is available to activate their IBAN](https://gnosispay.mintlify.app/api-reference/iban/check-iban-availability):

```bash cURL
curl -X GET /api/v1/ibans/available
```

If you receive a `"available": false`, the flow ends here.

<Warning>
Requirements the User must have:
- An active EURe Safe Account
- KYC verified and approved
- Residency in a supported country
- Nationality from a supported country ([see allowed and restricted nationalities](https://help.gnosispay.com/en/articles/9795352-nationalities-allowed-and-restricted-for-the-iban-feature))
</Warning>

## Enabling the IBAN Integration


<Steps titleSize="h3">
<Step title="Signing the Monerium message">

Monerium requires a specific message to be signed by the User's wallet.
[Use this endpoint get the exact message that needs to be signed](https://gnosispay.mintlify.app/api-reference/iban/get-the-message-that-needs-to-be-signed-for-iban-activation):

```bash cURL
curl -X GET /api/v1/ibans/signing-message
```

To request signature from your gnosis safe, you can follow this [demo signature implementation](#message-signing-example-with-gnosispay-account-kit).

<Warning>
We cannot request new IBANs nor transfer existing IBANs until the message signature is completed. This signature is a mandatory requirement from Monerium to verify ownership of the address.
</Warning>
</Step>
<Step title="Request the IBAN from Monerium">


[You need to call this endpoint to request your IBAN profile](): 

```bash cURL
curl -X POST /api/v1/ibans/monerium-profile \
-d '{
  "signature": "... signed message as a string ...",
  "callbackUrl": "https://your-app.com/iban-callback"
}'
```
<Warning>
**This endpoint can fail and it is expected:** Monerium only allows the user to have one single account with them. If the user already has an account, this call will fail to indicate you should follow the oAuth flow with Monerium.
</Warning>

There are two results possible here: 

1. If the User is not registered with Monerium you will receive a `"success": true` and it will take 3+ mininutes (due to the delay module that verifies the signature and ownership of the address) for the new Monerium account to be created;
2. The user already has a Monerium profile, so we need to request access to it via an oAuth flow, in this case the request will fail as expected.

When your User already have a Monerium account, we need to redirect the user to a URL so they can allow GnosisPay to interact with
their existing account. So the `POST` will return a `422` error with the following body:

```json
{
  errors: {
    externalApiCallStatusCode: 304,
    message: "User needs to be redirect to Monerium oAuth flow",
    redirectUrl: "... url ...",
  },
}
```

You need to redirect your users when `externalApiCallStatusCode == 304`.
After the User approves our access to their existing account, the background job will pick up from there and user will be redirected to the provided callback URL.

Another way to get the redirect URL if user has Monerium profile already is to use the `/api/v1/ibans/oauth/redirect_url` endpoint.

<Note>
`callbackUrl` should always be sent as query parameter in both the cases.
</Note>

</Step>
<Step title="Get the IBAN number, BIC, Status and Connected Blockchain Address where funds are sent">

[You should monitor this endpoint until you see a status of `ASSIGNED`](https://gnosispay.mintlify.app/api-reference/iban/retrieve-iban-details):

```bash cURL
curl -X GET /api/v1/ibans/details
```

Use this data to cash-in to your GnosisPay Account.

| IBAN Status | Description | Action |
| ------------- | -------------- | -------------- |
| NOTSTARTED | Initial state when the user hasn't started the IBAN creation process yet | User needs to initiate the IBAN creation process |
| PENDING | IBAN creation has been initiated and is being processed by Monerium | Wait for the process to complete, periodically check the status |
| PENDING_OAUTH | User has an existing Monerium profile and needs to authorize GnosisPay via OAuth | Redirect the user to the OAuth URL provided in the response |
| ASSIGNED | IBAN has been successfully created and assigned to the user | IBAN is ready to use for cash-in transactions |
</Step>
<Step title="Get the IBAN Statement (Orders list)">

To get a complete statement for the orders processed through IBAN:

```bash cURL
curl -X GET /api/v1/ibans/orders
```

<Note>
This endpoint returns only incoming orders (deposits) to the user's IBAN.
</Note>
</Step>
</Steps>


## Message Signing Example with GnosisPay Account Kit

You can use the GnosisPay Account Kit as example to generate a signature for endpoint.
You can find the Account Kit code in our [GitHub repository](https://github.com/gnosispay/account-kit/).

### Example Usage

```typescript
import { Wallet } from 'ethers';
import {
  populateExecuteEnqueue,
  predictAccountAddress,
  createInnerSignMessageTransaction
} from '@gnosispay/account-kit';

// Initialize your wallet
const wallet = new Wallet(privateKey, provider);

// Predict the account address
const owner = wallet.address;
const safeAddress = predictAccountAddress({ owner });

// Create a transaction to sign a message
const transaction = createInnerSignMessageTransaction(
  "I hereby declare that I am the address owner."
);

// Generate the execute transaction with signature
const enqueueTx = await populateExecuteEnqueue(
  { account: safeAddress, chainId: 100 },
  transaction,
  ({ domain, types, message }) => wallet._signTypedData(domain, types, message)
);

// The transaction data contains the signature
console.log(enqueueTx.data, '-> signature');
```

<Info>
Note:
- The message can be fetched from the API using `GET /api/v1/ibans/signing-message`
- The generated transaction can be submitted to prove ownership
- Make sure to use the correct chainId (100 for Gnosis Chain)
</Info>