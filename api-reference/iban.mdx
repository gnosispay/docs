---
title: IBAN API
description: IBAN API endpoints with direct EIP-712 signing support
---

## GET /api/v1/ibans/transaction-data

Returns complete EIP-712 typed data structure for IBAN ownership verification that can be signed directly with any wallet.

**Authentication**: Required (Bearer token)

**Request**: No body required

**Response Structure**:
```json
{
  "data": {
    "domain": {
      "name": "Safe Message Lib",
      "version": "1.0",
      "chainId": 100,
      "verifyingContract": "0xd53cd0aB83D845Ac265BE939c57F53AD838012c9"
    },
    "types": {
      "EIP712Domain": [
        {"name": "name", "type": "string"},
        {"name": "version", "type": "string"},
        {"name": "chainId", "type": "uint256"},
        {"name": "verifyingContract", "type": "address"}
      ],
      "SafeMessage": [
        {"name": "message", "type": "bytes"}
      ]
    },
    "primaryType": "SafeMessage",
    "message": {
      "message": "0x..."
    }
  }
}
```

**Error Responses**:
- `422`: User doesn't have Safe assigned for IBAN creation

**Example Usage**:
```typescript
const response = await fetch('/api/v1/ibans/transaction-data', {
  headers: { 'Authorization': `Bearer ${token}` }
});
const typedData = await response.json();

// Sign directly with any wallet
const signature = await wallet.signTypedData(typedData.data);
```

## POST /api/v1/ibans/new-profile

Creates Monerium profile using raw EIP-712 signature obtained from the transaction-data endpoint.

**Authentication**: Required (Bearer token)

**Request Body**:
```json
{
  "signature": "0x1234567890abcdef...", // Raw EIP-712 signature (130 chars)
  "callbackUrl": "https://example.com"   // OAuth callback URL
}
```

**Response Codes**:
- `200`: Profile created successfully
- `400`: Invalid request data or signature format
- `422`: Business logic validation errors

**Business Logic Validation**:
The endpoint validates the following requirements:
- User authentication
- KYC verification status
- Personal data completeness
- Location data requirements
- Country restrictions (EEA/Swiss only)
- Monerium restricted countries check
- Existing IBAN prevention

**OAuth Flow Handling**:
If the user already has a Monerium profile, the request will return a `422` error with redirect information:

```json
{
  "errors": {
    "externalApiCallStatusCode": 304,
    "message": "User needs to be redirect to Monerium oAuth flow",
    "redirectUrl": "... url ..."
  }
}
```

**Example Usage**:
```typescript
const response = await fetch('/api/v1/ibans/new-profile', {
  method: 'POST',
  headers: { 
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    signature: '0x1234567890abcdef...',
    callbackUrl: 'https://your-app.com/iban-callback'
  })
});
```

## Complete Integration Example

Here's a complete example of how to integrate IBAN functionality:

```typescript
// Step 1: Get complete typed data
const typedDataResponse = await fetch('/api/v1/ibans/transaction-data', {
  headers: { 'Authorization': `Bearer ${token}` }
});
const typedData = await typedDataResponse.json();

// Step 2: Sign directly with any wallet
const signature = await wallet.signTypedData(typedData.data);

// Step 3: Submit raw signature
const profileResponse = await fetch('/api/v1/ibans/new-profile', {
  method: 'POST',
  headers: { 
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    signature,
    callbackUrl: 'https://your-app.com/iban-callback'
  })
});

if (profileResponse.ok) {
  console.log('IBAN profile creation initiated successfully');
} else {
  const error = await profileResponse.json();
  // Handle OAuth redirect if user has existing Monerium profile
  if (error.errors?.externalApiCallStatusCode === 304) {
    window.location.href = error.errors.redirectUrl;
  }
}
```

## Key Benefits

- ✅ **Universal wallet compatibility** - Works with all EIP-712 compatible wallets
- ✅ **No specialized dependencies** - Standard wallet integration only
- ✅ **Simple implementation** - Direct `signTypedData()` method
- ✅ **Reduced complexity** - Straightforward client-side code
- ✅ **Smaller bundle size** - No additional libraries required
